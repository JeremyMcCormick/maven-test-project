name: test release
on: 
  release:
    types: [published]

jobs:
  build:  
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build and Test
        uses: qcastel/github-actions-maven-cmd@master
        with:
          maven-args: "clean install -Ddockerfile.skip -DdockerCompose.skip -Djib.skip"

      - name: Release
        uses: qcastel/github-actions-maven-release@master
        env:
          JAVA_HOME: /usr/lib/jvm/java-11-openjdk/
        with:
          maven-args: "-Dmaven.javadoc.skip=true -DskipTests -DskipITs -Dmaven.deploy.skip=true"
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      #- name: Dump Shell Environment
      #  run: env | sort

      #- name: Dump GitHub Context
      #  run: echo '${{ toJSON(github) }}'

      #- name: Print Release Information
      #  env:
      #    TAG_NAME: ${{ github.event.release.tag_name }}
      #  run: echo "${TAG_NAME}"

      #- name: Setup Java
      #  uses: actions/setup-java@v3
      #  with:
      #    java-version: '8'
      #    distribution: 'adopt'
      #    architecture: x64
           
      #- name: Setup Maven
      #  uses: stCarolas/setup-maven@v4.5
      #  with:
      #    maven-version: 3.9.0

      #- name: Checkout Code
      #  uses: actions/checkout@v2
        
      #- name: Run tests
      #  run: mvn clean install

      #- name: Perform Release
      #  with:
      #    ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
      #  run: |
      #    mvn release:clean release:prepare release:perform \
      #      -Dresume=false -DskipTests -Darguments="-DskipTests -Dmaven.javadoc.skip=true" 
 
#         - name: Release
#      uses: qcastel/github-actions-maven-release@v1.12.39
#      with:
#      
# release:clean release:prepare release:perform -Dresume=false -Dgoals=deploy -DskipTests 
# -Darguments="-DskipTests -Dmaven.javadoc.skip=true" -s /nfs/slac/g/lcd/mc/prj/sw/hudson/hudson-settings-lcd.xml

#        run: mvn --batch-mode --update-snapshots package


#      - name: Release
#        uses: qcastel/github-actions-maven-release@master
#        env:
#           JAVA_HOME: /usr/lib/jvm/java-11-openjdk/
#        with:
#          maven-args: "-Dmaven.javadoc.skip=true -DskipTests -DskipITs -Dmaven.deploy.skip=true"

#jobs:
#  build:
#    runs-on: ubuntu-latest

#  steps:
#    - uses: actions/checkout@v3  

#    - name: Build and Test
#      uses: qcastel/github-actions-maven-cmd@master
#      with:
#        maven-args: "clean install -DskipTests"

#    - name: Release
#      uses: qcastel/github-actions-maven-release@master
#      env:
#        JAVA_HOME: /usr/lib/jvm/java-11-openjdk/
#      with:
#        maven-args: "-Dmaven.javadoc.skip=true -DskipTests -DskipITs -Dmaven.deploy.skip=true"